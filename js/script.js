const productData = {
  plantillaParejas: {
    title: 'Plantilla Financiera Mensual de Parejas (3 en 1)',
    keyword: 'PAREJAS',
    image: 'imagenes/Actualizar a pro.png',
    paypalLink: 'https://www.paypal.com/ncp/payment/MMKRVF9QGFU5U',

    stripeLink: 'https://buy.stripe.com/8x214ngEx89Z9f20Xs3oA0c',
    content: `
    <h2>Plantilla Financiera Mensual de Parejas (3 en 1) - 25% OFF</h2>
    <p>Esta plantilla es tu nueva aliada para construir finanzas sanas juntos (sin drama, sin confusi√≥n y sin pasar lucha).</p>
    
    <h3>¬øQu√© incluye?</h3>
    <ul>
      <li>üí¨ <strong>Presupuesto mensual en pareja:</strong> Organicen cada peso que entra y que sale, de manera clara, sencilla y adaptada a su realidad, no a f√≥rmulas gen√©ricas.</li>
      <li>üí¨ <strong>Planificador de pago de deuda.</strong></li>
      <li>üí¨ <strong>Planificador de metas de ahorro.</strong></li>
      <li>üí¨ <strong>Videotutorial de uso.</strong></li>
    </ul>
    
    <p>Todo en un solo lugar. F√°cil, visual y s√∫per pr√°ctico.</p>
    <p>Incluye todo lo que amas de nuestra versi√≥n PRO (res√∫menes, trackers inteligentes, indicadores visuales de progreso, alertas de presupuesto y m√°s).</p>

    <h3>Ideal para parejas que quieren:</h3>
    <ul>
      <li>‚úîÔ∏è Establecer objetivos reales y alcanzables.</li>
      <li>‚úîÔ∏è Planificar gastos, pagar deudas y ahorrar... sin morir en el intento.</li>
      <li>‚úîÔ∏è Tomar decisiones financieras juntos con m√°s confianza y claridad.</li>
    </ul>

    <p>Incluye un videotutorial de uso con tips y hacks para que le saquen el M√ÅXIMO provecho.</p>

    <h3>BONOS</h3>
    <p>S√≠, hay m√°s:</p>
    <ul>
      <li>üí¨ <strong>Gu√≠a de presupuesto en pareja</strong> (valorado en 15 USD)</li>
      <li>üí¨ <strong>Plantilla para planear actividades</strong> (valorado en 10 USD)</li>
      <li>üí¨ <strong>Plantilla Reto de ahorro imprimible</strong> (valorado en 5 USD)</li>
    </ul>

    <h3>Notas importantes:</h3>
    <ul>
      <li>NO necesitas ser experto en Google Sheets o finanzas. La plantilla est√° dise√±ada para que cualquier pareja pueda usarla de manera sencilla y efectiva desde el primer d√≠a.</li>
      <li><strong>IMPORTANTE:</strong> Esta plantilla solo es compatible con Google Sheets.</li>
      <li><strong>IMPORTANTE:</strong> Al ser un producto digital, todas las ventas son finales, sin reembolso.</li>
      <li>Esta plantilla est√° protegida por copyright y es propiedad de Planifesto; su uso es exclusivo para la pareja que la adquiera. Cualquier redistribuci√≥n, reventa o reproducci√≥n (completa o parcial) est√° estrictamente prohibida.</li>
      <li><strong>IMPORTANTE:</strong> Luego de realizada la compra, se te enviar√° el documento al correo ingresado en PayPal. Si ha pasado 1 minuto y a√∫n no recibes el correo, revisa la carpeta de spam. üíñ</li>
    </ul>
  `
  },
  comboPlanifesto: {
    title: 'Combo Planifesto - PRO + Gu√≠a de Inversi√≥n',
    keyword: 'COMBO',
    image: 'imagenes/comboPlanifesto.png',
    paypalLink: 'https://www.paypal.com/ncp/payment/54X5YD4Y83FQ4',
    stripeLink: 'https://buy.stripe.com/4gMeVdewpai74YM35A3oA0b',
    content: `
    <h2>‚ú® 3 PLANTILLAS PODEROSAS EN 1: Tu sistema financiero completo en un solo lugar + Nuestra gu√≠a para aprender a invertir ‚ú®</h2>
    <p>¬°Todo autom√°tico y conectado entre s√≠!</p>
    
    <h3>üéØ TU SISTEMA FINANCIERO ALL-IN-ONE:</h3>
    <ul>
      <li>‚≠ê ¬°Incluye nuestra Gu√≠a de Inversiones 101!</li>
      <li>‚≠ê Presupuesto mensual que realmente entiende tu estilo de vida</li>
      <li>‚≠ê Planificador inteligente de pago de deudas que hace todos los c√°lculos por ti</li>
      <li>‚≠ê Sistema de metas de ahorro que te mantiene motivada y en el camino correcto</li>
    </ul>
    
    <p>Todo esto con un dise√±o est√©tico que te encantar√° usar y la practicidad que necesitas.</p>

    <h3>Imagina tener en <strong>UN SOLO LUGAR:</strong></h3>
    <ul>
      <li>‚≠ê Tu presupuesto mensual perfectamente organizado</li>
      <li>‚≠ê Un plan claro para decir adi√≥s a tus deudas (con calculadora autom√°tica incluida üôå)</li>
      <li>‚≠ê Tus metas de ahorro visualizadas y calculadas (desde ese viaje so√±ado hasta tu primer apto)</li>
    </ul>

    <p><strong>¬øPor qu√© es diferente?</strong> Porque mientras otras plantillas te hacen saltar de un archivo a otro, Planifesto PRO 3-1 integra todo en un sistema cohesivo que:</p>
    <ul>
      <li>‚≠ê Hace todos los c√°lculos autom√°ticamente</li>
      <li>‚≠ê Mantiene tus finanzas sincronizadas</li>
      <li>‚≠ê Te muestra el panorama completo de tu dinero en un dashboard visual s√∫per cuteü•∞</li>
    </ul>

    <h3>Para la chica que:</h3>
    <ul>
      <li>Est√° cansada de tener sus finanzas dispersas en diferentes lugares</li>
      <li>Quiere un sistema completo que haga el trabajo pesado por ella</li>
      <li>Busca una soluci√≥n que combine cuteness y funcionalidad</li>
      <li>Desea tomar el control de sus finanzas sin sentirse abrumada</li>
    </ul>

    <p>Todo esto en un dise√±o moderno y est√©tico que te motivar√° a usar d√≠a tras d√≠a. Sin m√°s archivos perdidos, sin m√°s c√°lculos complicados, sin m√°s desorganizaci√≥n.</p>
    <p>Tu futuro financiero nunca se hab√≠a visto tan bienüíÖ‚ú®</p>
    <p>¬øEst√°s lista?</p>
  `
  },
  plantillaPro: {
    title: 'Plantilla Financiera PRO (3-1)',
    keyword: 'PRO',
    image: 'imagenes/planifestoPro.png',
    paypalLink: 'https://www.paypal.com/ncp/payment/YHWFXT36PGABE',
    neutralPaypalLink: 'https://www.paypal.com/ncp/payment/78N5AADLPGV8J',
    stripeLink: 'https://buy.stripe.com/7sYbJ10Fz9e362Q21w3oA0d',
    neutralStripeLink: 'https://buy.stripe.com/dRmbJ1dslbmbdvidKe3oA0e',
    content: `
    <h2>‚ú® 3 PLANTILLAS PODEROSAS EN 1: Tu sistema financiero completo en un solo lugar ‚ú®</h2>
    <p>¬°Todo autom√°tico y conectado entre s√≠!</p>
    
    <h3>üéØ TU SISTEMA FINANCIERO ALL-IN-ONE:</h3>
    <ul>
      <li>‚≠ê Presupuesto mensual que realmente entiende tu estilo de vida</li>
      <li>‚≠ê Planificador inteligente de pago de deudas que hace todos los c√°lculos por ti</li>
      <li>‚≠ê Sistema de metas de ahorro que te mantiene motivada y en el camino correcto</li>
    </ul>
    
    <p>Todo esto con un dise√±o est√©tico que te encantar√° usar y la practicidad que necesitas.</p>

    <h3>Imagina tener en <strong>UN SOLO LUGAR:</strong></h3>
    <ul>
      <li>‚≠ê Tu presupuesto mensual perfectamente organizado</li>
      <li>‚≠ê Un plan claro para decir adi√≥s a tus deudas (con calculadora autom√°tica incluida üôå)</li>
      <li>‚≠ê Tus metas de ahorro visualizadas y calculadas (desde ese viaje so√±ado hasta tu primer apto)</li>
    </ul>

    <p><strong>¬øPor qu√© es diferente?</strong> Porque mientras otras plantillas te hacen saltar de un archivo a otro, Planifesto PRO 3-1 integra todo en un sistema cohesivo que:</p>
    <ul>
      <li>‚≠ê Hace todos los c√°lculos autom√°ticamente</li>
      <li>‚≠ê Mantiene tus finanzas sincronizadas</li>
      <li>‚≠ê Te muestra el panorama completo de tu dinero en un dashboard visual s√∫per cuteü•∞</li>
    </ul>

    <h3>Para la chica que:</h3>
    <ul>
      <li>Est√° cansada de tener sus finanzas dispersas en diferentes lugares</li>
      <li>Quiere un sistema completo que haga el trabajo pesado por ella</li>
      <li>Busca una soluci√≥n que combine cuteness y funcionalidad</li>
      <li>Desea tomar el control de sus finanzas sin sentirse abrumada</li>
    </ul>

    <p>Todo esto en un dise√±o moderno y est√©tico que te motivar√° a usar d√≠a tras d√≠a. Sin m√°s archivos perdidos, sin m√°s c√°lculos complicados, sin m√°s desorganizaci√≥n.</p>
    <p>Tu futuro financiero nunca se hab√≠a visto tan bienüíÖ‚ú®</p>
    <p>¬øEst√°s lista?</p>
  `
  },
  plantillaBasica: {
    title: 'Plantilla Financiera',
    keyword: 'BASICA',
    image: 'imagenes/presupuestoMensual.png',
    paypalLink: 'https://www.paypal.com/ncp/payment/NQJNGY6WXKFK4',
    neutralPaypalLink: 'https://www.paypal.com/ncp/payment/CZ8E9M7F2YP3S',
    stripeLink: 'https://buy.stripe.com/aFadR90Fz89ZgHu35A3oA09',
    neutralStripeLink: 'https://buy.stripe.com/cNi3cv4VP89ZfDqcGa3oA0a',
    content: `
    <h2>Plantilla Financiera</h2>
    <p><strong>¬øLista para tomar el control de tus finanzas y convertirte en la jefa de tu dinero? üíÖ‚ú®</strong></p>
    <p>Esta plantilla financiera est√° dise√±ada especialmente para mujeres como t√∫, que quieren brillar en todos los aspectos de su vida, incluyendo sus finanzas.</p>
    
    <h3>Caracter√≠sticas principales</h3>
    <ul>
      <li>üå∏ Dise√±o moderno, est√©tico y super f√°cil de usar</li>
      <li>üå∏ Dashboard visual s√∫per cute con gr√°ficos</li>
      <li>üå∏ Compatible con tu laptop, tablet y cel</li>
      <li>üå∏ Plantilla est√©tica que te motivar√° a usarla</li>
      <li>üå∏ Espacio para tus metas financieras (desde ese viaje so√±ado hasta tu primer apto)</li>
      <li>üå∏ Categor√≠as personalizadas para tus gastos reales (s√≠, incluye Uber, compras online y esas salidas de finde)</li>
    </ul>
    
    <h3>Beneficios que cambiar√°n tu vida:</h3>
    <ul>
      <li>üå∏ Automatizaci√≥n de c√°lculos financieros</li>
      <li>üå∏ Di adi√≥s a la ansiedad de fin de mes</li>
      <li>üå∏ Construye tu independencia financiera sin sacrificar tu estilo de vida</li>
      <li>üå∏ Aprende a invertir tu dinero de manera inteligente</li>
      <li>üå∏ Crea un futuro financiero s√≥lido mientras disfrutas tu presente</li>
      <li>üå∏ Ten el control total de tu dinero sin sentirte abrumada</li>
      <li>üå∏ Logra tus metas financieras sin dejar de vivir tu mejor vida</li>
      <li>üå∏ Ahorra para lo que realmente importa (ya sea ese bolso que amas o tu fondo de emergencia)</li>
    </ul>
    
    <p><strong>¬°Es momento de ser la CEO de tu vida financiera! Esta plantilla es tu mejor amiga para conseguir esa independencia financiera que mereces y sin complicaciones. ¬°Invierte en ti misma hoy! Tu yo del futuro (y tu cuenta bancaria) te lo agradecer√°n üíñ</strong></p>
  `
  },
  bundleFinanzas: {
    title: 'Gu√≠a de Inversiones 101 ‚Äì VERSI√ìN 2.0',
    keyword: 'GUIA101',
    image: 'imagenes/GuiaInversiones101redisenada.png',
    paypalLink: 'https://www.paypal.com/ncp/payment/N6X97A4JJRMM2',
    stripeLink: 'https://buy.stripe.com/8x2dR9cohcqf62Q7lQ3oA0h',
    content: `
    <h2>Gu√≠a de Inversiones 101 ‚Äì VERSI√ìN 2.0</h2>
    <p><strong>El manual que te hubiera ahorrado a√±os de miedo, dudas y malas decisiones con tu dinero.</strong></p>

    <h3>Seamos claros desde el inicio:</h3>
    <p>Si t√∫‚Ä¶</p>
    <ul>
      <li>trabajas y ahorras "un chin"</li>
      <li>sabes que dejar el dinero quieto es perder</li>
      <li>ves todo el mundo hablando de invertir</li>
      <li>pero no sabes por d√≥nde empezar sin meterte en un l√≠o</li>
    </ul>
    <p>üëâ <strong>esta gu√≠a NO es opcional. Es necesaria.</strong></p>

    <p>Porque el problema no es que no quieras invertir. El problema es que nadie te explic√≥ c√≥mo hacerlo bien, paso a paso y en tu realidad.</p>

    <h3>Invertir no es solo para expertos. Pero improvisar s√≠ sale caro.</h3>
    <p>La mayor√≠a de las personas:</p>
    <ul>
      <li>invierte tarde</li>
      <li>invierte por moda</li>
      <li>o invierte sin entender</li>
    </ul>
    <p>Y luego vienen:<br>
    ‚ùå malas decisiones<br>
    ‚ùå retiros por p√°nico<br>
    ‚ùå frustraci√≥n<br>
    ‚ùå "eso no es para m√≠"</p>

    <p><strong>Esta gu√≠a existe para romper ese ciclo.</strong></p>

    <h3>¬øQu√© es la Gu√≠a de Inversiones 101 ‚Äì 2.0?</h3>
    <p>Es una gu√≠a completamente redise√±ada y actualizada, creada para j√≥venes inversionistas principiantes, que quieren aprender a invertir con cabeza, sin miedo y sin enredos.</p>
    <p>Nada t√©cnico.<br>
    Nada acad√©mico.<br>
    Nada copiado de Google.</p>
    <p><strong>Todo explicado aplatana'o, con ejemplos reales y enfocado 100% en Rep√∫blica Dominicana.</strong></p>

    <h3>üöÄ ¬øQu√© vas a lograr con esta gu√≠a?</h3>
    <ul>
      <li>‚úîÔ∏è Entender c√≥mo funcionan las inversiones (de verdad)</li>
      <li>‚úîÔ∏è Saber qu√© opciones son buenas para empezar y cu√°les NO</li>
      <li>‚úîÔ∏è Identificar tu perfil de riesgo</li>
      <li>‚úîÔ∏è Aprender a analizar una inversi√≥n b√°sica antes de decir que s√≠</li>
      <li>‚úîÔ∏è Evitar errores comunes que cuestan dinero</li>
      <li>‚úîÔ∏è Estar lista/o para hacer tu primera inversi√≥n con intenci√≥n</li>
    </ul>
    <p><strong>No para hacerte rica/o ma√±ana. Sino para empezar bien HOY.</strong></p>

    <h3>üìò ¬øQu√© incluye?</h3>
    <h4>üîπ Parte 1 ‚Äì Inversiones b√°sicas (la base que TODO el mundo necesita)</h4>
    <ul>
      <li>Conceptos clave explicados en lenguaje simple</li>
      <li>Riesgo vs recompensa</li>
      <li>Test de perfil de inversionista</li>
      <li>Cuentas de ahorro de alto rendimiento</li>
      <li>Certificados financieros</li>
      <li>Fondos de inversi√≥n abiertos</li>
      <li>Procesos reales de inversi√≥n en RD</li>
      <li>C√≥mo leer y entender una inversi√≥n sin ser experta/o</li>
    </ul>

    <h4>üéÅ BONO EXCLUSIVO ‚Äì Parte 2</h4>
    <h4>Intro al Mercado de Valores de la Rep√∫blica Dominicana üá©üá¥</h4>
    <p><strong>Aqu√≠ es donde la mayor√≠a se pierde‚Ä¶ y t√∫ no.</strong></p>
    <p>Aprender√°s:</p>
    <ul>
      <li>Qu√© es realmente el mercado de valores</li>
      <li>C√≥mo funcionan acciones, bonos y fondos</li>
      <li>Qu√© hacen los puestos de bolsa y las AFIs</li>
      <li>C√≥mo est√° regulado el mercado en RD</li>
      <li>Qu√© necesitas para dar el siguiente paso cuando est√©s lista/o</li>
    </ul>
    <p>Este bono te abre la cabeza y te prepara para decisiones m√°s grandes, sin improvisar.</p>

    <h4>üéÅ M√ÅS BONOS (solo por comprar la gu√≠a)</h4>
    <ul>
      <li>‚ú® Plantillas de regalo</li>
      <li>‚ú® Retos de ahorro y h√°bitos financieros</li>
      <li>‚ú® Gu√≠as complementarias para arrancar con orden</li>
      <li>‚ú® Descuentos exclusivos en otros productos Planifesto</li>
    </ul>
    <p>Todo pensado para que no te quedes solo/a leyendo, sino actuando.</p>

    <h3>üß† ¬øPara qui√©n es esta gu√≠a?</h3>
    <ul>
      <li>‚úîÔ∏è Si quieres empezar a invertir pero no sabes c√≥mo</li>
      <li>‚úîÔ∏è Si te da miedo equivocarte con tu dinero</li>
      <li>‚úîÔ∏è Si est√°s cansada/o de informaci√≥n confusa</li>
      <li>‚úîÔ∏è Si quieres aprender ANTES de arriesgar</li>
      <li>‚úîÔ∏è Si quieres invertir con calma, criterio y claridad</li>
    </ul>
    <p>‚ö†Ô∏è <strong>No es para ti si buscas "dinero r√°pido" o f√≥rmulas m√°gicas.</strong></p>

    <h3>No invertir tambi√©n es una decisi√≥n. Y suele ser una de las m√°s caras.</h3>
    <p>La inflaci√≥n no espera.<br>
    El tiempo no se recupera.<br>
    Y nadie va a organizar tu futuro financiero por ti.</p>

    <p>üìå <strong>Esta gu√≠a no es un gasto. Es el primer paso para dejar de improvisar con tu dinero.</strong></p>

    <p>Si est√°s aqu√≠ leyendo esto, ya sabes que la necesitas.</p>

    <p>üëâ <strong>Empieza hoy. Empieza con base. Empieza con intenci√≥n.</strong></p>

    <p><strong>El mejor momento para invertir fue ayer. El segundo mejor momento es AHORA.</strong></p>
  `
  },
  planificadorViajes: {
    title: 'Planificador de Viajes',
    keyword: 'VIAJES',
    paypalLink: 'https://www.paypal.com/ncp/payment/J6DVR9FNVQW28',
    content: `
    <h2>Planificador de Viajes</h2>
    <p><strong>Tu viaje so√±ado comienza antes de hacer la maleta</strong></p>
    
    <h3>¬øQu√© trae esta joya viajera? üëá</h3>
    
    <h4>üß≥ PLANIFICADOR DE VIAJE:</h4>
    <ul>
      <li>‚≠ê Calculadora de d√≠as que faltan</li>
      <li>‚≠ê Plan de ahorro con barra de progreso</li>
      <li>‚≠ê Proyecci√≥n de gastos</li>
    </ul>
    
    <h4>üí∏ PRESUPUESTO DETALLADO:</h4>
    <ul>
      <li>‚≠ê Categor√≠as personalizables</li>
      <li>‚≠ê Barra visual de presupuesto, ahorro y gastos pre viaje y durante tu viaje</li>
      <li>‚≠ê Registro de transacciones y compras</li>
      <li>‚≠ê Tracker del dinero gastado vs lo que queda</li>
    </ul>

    <h4>üìù CHECKLIST:</h4>
    <ul>
      <li>‚≠ê Divide por categor√≠as todo lo que necesitas llevar</li>
      <li>‚≠ê Ropa, higiene, tech, esenciales‚Ä¶ ¬°Nada se te queda!</li>
    </ul>

    <h4>üìÖ ITINERARIO + OUTFITS:</h4>
    <ul>
      <li>‚≠ê Planifica ma√±ana, tarde y noche de cada d√≠a</li>
      <li>‚≠ê Combina los outfits por bloques (¬°Adi√≥s maleta explotada!)</li>
    </ul>

    <h4>üìä RESUMEN FINANCIERO DEL VIAJE:</h4>
    <ul>
      <li>‚≠ê Promedio de gasto diario, barra por categor√≠a, lo m√°s caro/barato</li>
      <li>‚≠ê Tus 3 categor√≠as estrella y cu√°nto gastaste en compras impulsivas</li>
    </ul>

    <h4>üì∏ UN ESPACIO DE RECUERDOS:</h4>
    <ul>
      <li>‚≠ê Tienes un espacio para tus recuerdos, aprendizajes, an√©cdotas, momentos, etc.</li>
    </ul>

    <h4>üö® HOJA DE EMERGENCIAS:</h4>
    <ul>
      <li>‚≠ê Todos los datos importantes a mano si pasa algo</li>
    </ul>

    <h3>¬øPor qu√© la amar√°s?</h3>
    <ul>
      <li>‚úÖ Porque es visual, divertida, pr√°ctica y <strong>HERMOSA</strong> (como plus)</li>
      <li>‚úÖ Porque te evita estr√©s y te ayuda a ahorrar</li>
      <li>‚úÖ Porque convierte tu viaje en una experiencia consciente y √©pica</li>
      <li>‚úÖ S√≠, viene con videogu√≠a paso a paso para sacarle TODO el jugo</li>
      <li>‚úÖ S√≠, sirve para cualquier tipo de viaje, en cualquier fecha y moneda</li>
      <li>‚úÖ Y S√ç, tiene un <strong>BONAZO</strong>: Gu√≠a con hacks y tips para exprimir tu viaje al m√°ximo</li>
    </ul>

    <p><strong>üéí ¬øLista para viajar con todo bajo control?</strong></p>
    <p>üëâ Compra ahora y recibe acceso inmediato a la plantilla, el videotutorial y la gu√≠a BONO.</p>
  `
  },
  guiaInversion: {
    title: 'Gu√≠a de Inversi√≥n',
    keyword: 'GUIA',
    paypalLink: 'https://www.paypal.com/ncp/payment/MK5NL4YTWLU34',
    content: `
    <h2>Gu√≠a de Inversi√≥n</h2>
    <p><strong>Si est√°s aqu√≠, es porque quieres entrar al mundo de las inversiones pero a lo mejor no sabes por d√≥nde empezar y crees que es complicado o que hay que ser experta‚Ä¶ pero te digo algo? NADA m√°s alejado de la realidad!</strong></p>
    <p>En esta Gu√≠a Completa de Inversiones vamos a ir pasito a pasito, con informaci√≥n PR√ÅCTICA, para abrir tu primera inversi√≥n. Lo que te llevas de aqu√≠, la verdad es una joya!</p>
    
    <h3>Caracter√≠sticas principales</h3>
    <ul>
      <li>üå∏ Manual completo y estructurado de manera progresiva</li>
      <li>üå∏ Lenguaje claro y accesible para principiantes</li>
      <li>üå∏ Incluye test de personalidad para conocer tu perfil de inversor</li>
      <li>üå∏ Recursos adicionales como FAQs y listas de verificaci√≥n</li>
      <li>üå∏ Contenido pr√°ctico enfocado en <strong>toma de decisiones REALES</strong>. S√≠, hay teor√≠a, pero solo lo que <strong>NECESITAS saber s√≠ o s√≠</strong>, despu√©s todo lo dem√°s es pr√°ctica y √∫til</li>
    </ul>
    
    <h3>Beneficios que obtendr√°s</h3>
    <ul>
      <li>üå∏ Aprender√°s los conceptos fundamentales de inversi√≥n sin abrumarte</li>
      <li>üå∏ Entender√°s la relaci√≥n entre riesgo y recompensa para tomar mejores decisiones</li>
      <li>üå∏ Descubrir√°s qu√© instrumentos de inversi√≥n se ajustan mejor a tus objetivos</li>
      <li>üå∏ Sabr√°s exactamente qu√© pasos seguir antes de realizar tu primera inversi√≥n</li>
      <li>üå∏ Ganar√°s confianza para comenzar a invertir de manera informada</li>
      <li>üå∏ Evitar√°s errores comunes de principiantes que pueden costarte dinero (mucho)</li>
      <li>üå∏ Vas a tener una lista de recomendaciones, con enlaces directos a la p√°gina oficial de la instituci√≥n para que vayas derechito a realizar tu primera inversi√≥n</li>
    </ul>
    
    <p><strong>Esta gu√≠a te llevar√° de la mano desde los conceptos b√°sicos hasta estrategias m√°s avanzadas, incluyendo informaci√≥n crucial sobre cuentas de alto rendimiento, certificados financieros y fondos de inversi√≥n. NO m√°s dudas, NO m√°s miedos. Con esta gu√≠a, tendr√°s todas las herramientas necesarias para comenzar tu camino hacia la independencia financiera de manera segura y consciente. ¬°Invierte en tu futuro hoy! Tu yo del ma√±ana te lo agradecer√°.</strong></p>
  `
  }
};

// State variables
let currentNeutralStates = {
  pro: false,
  basic: false
};

// Gift Mode
// URL del Google Apps Script desplegado como web app
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxJKtudIK7Lx-9kmd4Sm90ui8BqYoVRtroQYH6RPTmooy_kcRVHoR4neytIYZh8ti4-/exec';

let giftModeActive = false;
const productPrices = {
  comboPlanifesto: { original: 33.00, current: 25.00 },
  plantillaPro: { original: 25.00, current: 19.99 },
  plantillaBasica: { original: null, current: 9.99 },
  plantillaParejas: { original: 57.00, current: 43.00 },
  bundleFinanzas: { original: 20.00, current: 14.00 }
};

function toggleGiftMode() {
  giftModeActive = !giftModeActive;
  const btn = document.getElementById('giftToggleBtn');
  const body = document.body;

  if (giftModeActive) {
    btn.classList.add('active');
    btn.querySelector('.gift-toggle-text').textContent = 'Modo Regalo Activado';
    body.classList.add('gift-mode-active');
    launchGiftExplosion();
  } else {
    btn.classList.remove('active');
    btn.querySelector('.gift-toggle-text').textContent = 'Activar Modo Regalo';
    body.classList.remove('gift-mode-active');
  }

  updateProductCardPrices();
}

function toggleGiftInModal(productId) {
  // Toggle gift state and update main page button
  toggleGiftMode();

  const modalContent = document.getElementById('modalContent');
  const product = productData[productId];

  if (giftModeActive) {
    // --- ACTIVATING: inject gift form + swap payment section ---

    // Hide the "Regalar" card
    const giftToggleCard = modalContent.querySelector('.modal-gift-toggle');
    if (giftToggleCard) giftToggleCard.style.display = 'none';

    // Build and inject the gift form before payment-options
    const paymentOptions = modalContent.querySelector('.payment-options');
    const giftFormDiv = document.createElement('div');
    giftFormDiv.className = 'gift-form-section gift-form-animate';
    giftFormDiv.innerHTML = `
      <h3 class="gift-form-title">&#127873; Datos del Regalo</h3>
      <p class="gift-form-subtitle">Enviaremos el producto directamente a esta persona con un mensaje especial de tu parte</p>
      <div class="gift-form-field">
        <label for="giftBuyerName">Tu nombre</label>
        <input type="text" id="giftBuyerName" placeholder="Ej: Fulanito De Tal">
      </div>
      <div class="gift-form-field">
        <label for="giftBuyerEmail">Tu correo electr&#243;nico</label>
        <input type="email" id="giftBuyerEmail" placeholder="Ej: fulanito@email.com">
        <small class="gift-email-hint">&#9888;&#65039; Usa el mismo correo con el que vas a realizar el pago</small>
      </div>
      <div class="gift-form-field">
        <label for="giftRecipientName">Nombre de quien recibe el regalo</label>
        <input type="text" id="giftRecipientName" placeholder="Ej: Fulanito De Tal">
      </div>
      <div class="gift-form-field">
        <label for="giftRecipientContact">Correo electr&#243;nico de quien recibe</label>
        <input type="email" id="giftRecipientContact" placeholder="Ej: fulanito@email.com">
      </div>
      <div class="gift-form-field">
        <label for="giftMessage">Dedicatoria (opcional)</label>
        <textarea id="giftMessage" placeholder="Ej: Felicidades! Te quiero mucho &#10084;&#65039;" rows="3" maxlength="200"></textarea>
        <small class="gift-char-counter"><span id="giftMessageCount">0</span>/200</small>
      </div>
    `;
    paymentOptions.parentNode.insertBefore(giftFormDiv, paymentOptions);

    // Wire up character counter
    const giftMsg = document.getElementById('giftMessage');
    const giftCount = document.getElementById('giftMessageCount');
    if (giftMsg && giftCount) {
      giftMsg.addEventListener('input', function() {
        giftCount.textContent = this.value.length;
      });
    }

    // Wire up field error clearing
    const giftFields = [
      document.getElementById('giftBuyerName'),
      document.getElementById('giftBuyerEmail'),
      document.getElementById('giftRecipientName'),
      document.getElementById('giftRecipientContact')
    ];
    giftFields.forEach(field => {
      if (field) field.addEventListener('input', function() {
        this.classList.remove('gift-input-error');
      });
    });

    // Determine PayPal link for gift
    let currentPaypalLink = product.paypalLink;
    const isProNeutral = productId === 'plantillaPro' && currentNeutralStates.pro;
    const isBasicNeutral = productId === 'plantillaBasica' && currentNeutralStates.basic;
    if (isProNeutral) currentPaypalLink = product.neutralPaypalLink || currentPaypalLink;
    if (isBasicNeutral) currentPaypalLink = product.neutralPaypalLink || currentPaypalLink;

    // Replace the payment-options content with gift payment
    paymentOptions.innerHTML = `
      <h3 class="payment-title">&#127873; Comprar como Regalo</h3>

      <button class="modal-gift-deactivate" onclick="toggleGiftInModal('${productId}')">
        &#10005; Desactivar Modo Regalo
      </button>

      <div class="terms-checkbox-container" id="termsCheckboxContainer">
        <label class="terms-checkbox-label">
          <input type="checkbox" id="termsCheckbox" class="terms-checkbox">
          <span>He le&#237;do y acepto los <button type="button" class="terms-link" onclick="openTermsModal()">T&#233;rminos y Condiciones</button></span>
        </label>
        <div class="terms-error-message" id="termsErrorMessage">
          ‚ö†Ô∏è Debes aceptar los T&#233;rminos y Condiciones para continuar
        </div>
      </div>

      <div class="payment-section">
        <h4>&#128179; Pago con tarjeta de cr&#233;dito/d&#233;bito</h4>
        <div class="payment-buttons">
          <button class="payment-btn paypal-btn" onclick="submitGiftAndPay('${currentPaypalLink}', '${productId}', 'paypal')">
            <span class="payment-icon">
              <svg width="80" height="32" viewBox="0 0 124 33" fill="none">
                <path d="M46.211 6.749h-6.839a.95.95 0 0 0-.939.802l-2.766 17.537a.57.57 0 0 0 .564.658h3.265a.95.95 0 0 0 .939-.803l.746-4.73a.95.95 0 0 1 .938-.803h2.165c4.505 0 7.105-2.18 7.784-6.5.306-1.89.013-3.375-.872-4.415-.972-1.142-2.696-1.746-4.985-1.746zM47 13.154c-.374 2.454-2.249 2.454-4.062 2.454h-1.032l.724-4.583a.57.57 0 0 1 .563-.481h.473c1.235 0 2.4 0 3.002.704.359.42.469 1.044.332 1.906zM66.654 13.075h-3.275a.57.57 0 0 0-.563.481l-.145.916-.229-.332c-.709-1.029-2.29-1.373-3.868-1.373-3.619 0-6.71 2.741-7.312 6.586-.313 1.918.132 3.752 1.22 5.031.998 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .562.66h2.95a.95.95 0 0 0 .939-.803l1.77-11.209a.568.568 0 0 0-.561-.658zm-4.565 6.374c-.316 1.871-1.801 3.127-3.695 3.127-.951 0-1.711-.305-2.199-.883-.484-.574-.668-1.391-.514-2.301.295-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.499.589.697 1.411.554 2.317zM84.096 13.075h-3.291a.954.954 0 0 0-.787.417l-4.539 6.686-1.924-6.425a.953.953 0 0 0-.912-.678h-3.234a.57.57 0 0 0-.541.754l3.625 10.638-3.408 4.811a.57.57 0 0 0 .465.9h3.287a.949.949 0 0 0 .781-.408l10.946-15.8a.57.57 0 0 0-.468-.895z" fill="#253B80"/>
                <path d="M94.992 6.749h-6.84a.95.95 0 0 0-.938.802l-2.766 17.537a.569.569 0 0 0 .562.658h3.51a.665.665 0 0 0 .656-.562l.785-4.971a.95.95 0 0 1 .938-.803h2.164c4.506 0 7.105-2.18 7.785-6.5.307-1.89.012-3.375-.873-4.415-.971-1.142-2.694-1.746-4.983-1.746zm.789 6.405c-.373 2.454-2.248 2.454-4.062 2.454h-1.031l.725-4.583a.568.568 0 0 1 .562-.481h.473c1.234 0 2.4 0 3.002.704.359.42.468 1.044.331 1.906zM115.434 13.075h-3.273a.567.567 0 0 0-.562.481l-.145.916-.23-.332c-.709-1.029-2.289-1.373-3.867-1.373-3.619 0-6.709 2.741-7.311 6.586-.312 1.918.131 3.752 1.219 5.031 1 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .564.66h2.949a.95.95 0 0 0 .938-.803l1.771-11.209a.571.571 0 0 0-.565-.658zm-4.565 6.374c-.314 1.871-1.801 3.127-3.695 3.127-.949 0-1.711-.305-2.199-.883-.484-.574-.666-1.391-.514-2.301.297-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.501.589.699 1.411.554 2.317zM119.295 7.23l-2.807 17.858a.569.569 0 0 0 .562.658h2.822c.469 0 .867-.34.938-.803l2.768-17.536a.57.57 0 0 0-.562-.659h-3.16a.571.571 0 0 0-.561.482z" fill="#179BD7"/>
                <path d="M7.266 29.154l.523-3.322-1.165-.027H1.061L4.927 1.292a.316.316 0 0 1 .314-.268h9.38c3.114 0 5.263.648 6.385 1.927.526.6.861 1.227 1.023 1.917.17.724.173 1.589.007 2.644l-.012.077v.676l.526.298a3.69 3.69 0 0 1 1.065.812c.45.513.741 1.165.864 1.938.127.795.085 1.741-.123 2.812-.24 1.232-.628 2.305-1.152 3.183a6.547 6.547 0 0 1-1.825 2c-.696.494-1.523.869-2.458 1.109-.906.236-1.939.355-3.072.355h-.73c-.522 0-1.029.188-1.427.525a2.21 2.21 0 0 0-.744 1.328l-.055.299-.924 5.855-.042.215c-.011.068-.03.102-.058.125a.155.155 0 0 1-.096.035H7.266z" fill="#253B80"/>
                <path d="M23.048 7.667c-.028.179-.06.362-.096.55-1.237 6.351-5.469 8.545-10.874 8.545H9.326c-.661 0-1.218.48-1.321 1.132L6.596 26.83l-.399 2.533a.704.704 0 0 0 .695.814h4.881c.578 0 1.069-.42 1.16-.99l.048-.248.919-5.832.059-.32c.09-.572.582-.992 1.16-.992h.73c4.729 0 8.431-1.92 9.513-7.476.452-2.321.218-4.259-.978-5.622a4.667 4.667 0 0 0-1.336-1.03z" fill="#179BD7"/>
                <path d="M21.754 7.151a9.757 9.757 0 0 0-1.203-.267 15.284 15.284 0 0 0-2.426-.177h-7.352a1.172 1.172 0 0 0-1.159.992L8.05 17.605l-.045.289a1.336 1.336 0 0 1 1.321-1.132h2.752c5.405 0 9.637-2.195 10.874-8.545.037-.188.068-.371.096-.55a6.594 6.594 0 0 0-1.017-.429 9.045 9.045 0 0 0-.277-.087z" fill="#222D65"/>
                <path d="M9.614 7.699a1.169 1.169 0 0 1 1.159-.991h7.352c.871 0 1.684.057 2.426.177a9.757 9.757 0 0 1 1.481.353c.365.121.704.264 1.017.429.368-2.347-.003-3.945-1.272-5.392C20.378.682 17.853 0 14.622 0h-9.38c-.66 0-1.223.48-1.325 1.133L.01 25.898a.806.806 0 0 0 .795.932h5.791l1.454-9.225 1.564-9.906z" fill="#253B80"/>
              </svg>
            </span>
          </button>
        </div>
      </div>

      <div class="payment-section">
        <h4>&#127974; Transferencias Bancarias (RD)</h4>
        <div class="transfer-buttons">
          <button class="payment-btn whatsapp-btn gift-whatsapp-btn" onclick="sendGiftWhatsApp('${productId}')">
            <span class="payment-icon">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
            </span>
            <span>Enviar regalo por WhatsApp</span>
          </button>
        </div>
      </div>

      <div class="payment-note">
        <p><strong>&#127873; Nota sobre el Modo Regalo:</strong></p>
        <p>&#8226; El producto se env&#237;a directo al correo de la persona que indiques</p>
        <p>&#8226; Incluir&#225; tu dedicatoria si la escribes</p>
        <p>&#8226; Producto digital - todas las ventas son finales</p>
        <p>&#8226; Compatible &#250;nicamente con Google Sheets</p>
      </div>
    `;

    // Wire up terms checkbox
    const termsCheckbox = document.getElementById('termsCheckbox');
    const termsContainer = document.getElementById('termsCheckboxContainer');
    const errorMessage = document.getElementById('termsErrorMessage');
    if (termsCheckbox) {
      termsCheckbox.checked = false;
      termsCheckbox.addEventListener('change', function() {
        if (this.checked) {
          termsContainer.classList.remove('error');
          errorMessage.classList.remove('show');
        }
      });
    }

    // Scroll to the gift form
    setTimeout(() => {
      giftFormDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 50);

  } else {
    // --- DEACTIVATING: remove gift form + restore normal payment ---

    // Remove gift form with animation
    const giftForm = modalContent.querySelector('.gift-form-section');
    if (giftForm) {
      giftForm.classList.add('gift-form-removing');
      giftForm.addEventListener('animationend', () => giftForm.remove(), { once: true });
    }

    // Restore normal payment - rebuild via showProductDetails without scroll reset
    const whatsappBaseMsg = `Hola!%20Me%20interesa%20la%20${encodeURIComponent(product.title)}%20-%20Transferencia%20bancaria`;
    let currentPaypalLink = product.paypalLink;
    let currentStripeLink = product.stripeLink;
    const isProNeutral = productId === 'plantillaPro' && currentNeutralStates.pro;
    const isBasicNeutral = productId === 'plantillaBasica' && currentNeutralStates.basic;
    if (isProNeutral) {
      currentPaypalLink = product.neutralPaypalLink || currentPaypalLink;
      currentStripeLink = product.neutralStripeLink || currentStripeLink;
    }
    if (isBasicNeutral) {
      currentPaypalLink = product.neutralPaypalLink || currentPaypalLink;
      currentStripeLink = product.neutralStripeLink || currentStripeLink;
    }

    const paymentOptions = modalContent.querySelector('.payment-options');
    paymentOptions.innerHTML = `
      <h3 class="payment-title">Opciones de Pago</h3>

      <div class="modal-gift-toggle" onclick="toggleGiftInModal('${productId}')">
        <span class="modal-gift-toggle-icon">&#127873;</span>
        <p class="modal-gift-toggle-text"><strong>Regala este producto</strong></p>
        <span class="modal-gift-toggle-btn">Regalar</span>
      </div>

      <div class="terms-checkbox-container" id="termsCheckboxContainer">
        <label class="terms-checkbox-label">
          <input type="checkbox" id="termsCheckbox" class="terms-checkbox">
          <span>He le&#237;do y acepto los <button type="button" class="terms-link" onclick="openTermsModal()">T&#233;rminos y Condiciones</button></span>
        </label>
        <div class="terms-error-message" id="termsErrorMessage">
          ‚ö†Ô∏è Debes aceptar los T&#233;rminos y Condiciones para continuar
        </div>
      </div>

      <div class="payment-section">
        <h4>&#128179; Pago con tarjeta de cr&#233;dito/d&#233;bito</h4>
        <div class="payment-buttons">
          <button class="payment-btn stripe-btn" onclick="validateAndBuy('${currentStripeLink}')">
            <span class="payment-icon">
              <svg width="80" height="32" viewBox="0 0 60 25" fill="none">
                <path d="M59.64 14.28h-8.06c.19 1.93 1.6 2.55 3.2 2.55 1.64 0 2.96-.37 4.05-.95v3.32a8.33 8.33 0 0 1-4.56 1.1c-4.01 0-6.83-2.5-6.83-7.48 0-4.19 2.39-7.52 6.3-7.52 3.92 0 5.96 3.28 5.96 7.5 0 .4-.04 1.26-.06 1.48zm-5.92-5.62c-1.03 0-2.17.73-2.17 2.58h4.25c0-1.85-1.07-2.58-2.08-2.58zM40.95 20.3c-1.44 0-2.32-.6-2.9-1.04l-.02 4.63-4.12.87V5.57h3.76l.08 1.02a4.7 4.7 0 0 1 3.23-1.29c2.9 0 5.62 2.6 5.62 7.4 0 5.23-2.7 7.6-5.65 7.6zM40 8.95c-.95 0-1.54.34-1.97.81l.02 6.12c.4.44.98.78 1.95.78 1.52 0 2.54-1.65 2.54-3.87 0-2.15-1.04-3.84-2.54-3.84zM28.24 5.57h4.13v14.44h-4.13V5.57zm0-4.7L32.37 0v3.36l-4.13.88V.88zm-4.32 9.35v9.79H19.8V5.57h3.7l.12 1.22c1-1.77 3.07-1.41 3.62-1.22v3.79c-.52-.17-2.29-.43-3.32.86zm-8.55 4.72c0 2.43 2.6 1.68 3.12 1.46v3.36c-.55.3-1.54.54-2.89.54a4.15 4.15 0 0 1-4.27-4.24l.01-13.17 4.02-.86v3.54h3.14V9.1h-3.13v5.85zm-4.91.7c0 2.97-2.31 4.66-5.73 4.66a11.2 11.2 0 0 1-4.46-.93v-3.93c1.38.75 3.1 1.31 4.46 1.31.92 0 1.53-.24 1.53-1C6.26 13.77 0 14.51 0 9.95 0 7.04 2.28 5.3 5.62 5.3c1.36 0 2.72.2 4.09.75v3.88a9.23 9.23 0 0 0-4.1-1.06c-.86 0-1.44.25-1.44.93 0 1.85 6.29.97 6.29 5.88z" fill="white"/>
              </svg>
            </span>
          </button>
          <button class="payment-btn paypal-btn" onclick="validateAndBuy('${currentPaypalLink}')">
            <span class="payment-icon">
              <svg width="80" height="32" viewBox="0 0 124 33" fill="none">
                <path d="M46.211 6.749h-6.839a.95.95 0 0 0-.939.802l-2.766 17.537a.57.57 0 0 0 .564.658h3.265a.95.95 0 0 0 .939-.803l.746-4.73a.95.95 0 0 1 .938-.803h2.165c4.505 0 7.105-2.18 7.784-6.5.306-1.89.013-3.375-.872-4.415-.972-1.142-2.696-1.746-4.985-1.746zM47 13.154c-.374 2.454-2.249 2.454-4.062 2.454h-1.032l.724-4.583a.57.57 0 0 1 .563-.481h.473c1.235 0 2.4 0 3.002.704.359.42.469 1.044.332 1.906zM66.654 13.075h-3.275a.57.57 0 0 0-.563.481l-.145.916-.229-.332c-.709-1.029-2.29-1.373-3.868-1.373-3.619 0-6.71 2.741-7.312 6.586-.313 1.918.132 3.752 1.22 5.031.998 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .562.66h2.95a.95.95 0 0 0 .939-.803l1.77-11.209a.568.568 0 0 0-.561-.658zm-4.565 6.374c-.316 1.871-1.801 3.127-3.695 3.127-.951 0-1.711-.305-2.199-.883-.484-.574-.668-1.391-.514-2.301.295-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.499.589.697 1.411.554 2.317zM84.096 13.075h-3.291a.954.954 0 0 0-.787.417l-4.539 6.686-1.924-6.425a.953.953 0 0 0-.912-.678h-3.234a.57.57 0 0 0-.541.754l3.625 10.638-3.408 4.811a.57.57 0 0 0 .465.9h3.287a.949.949 0 0 0 .781-.408l10.946-15.8a.57.57 0 0 0-.468-.895z" fill="#253B80"/>
                <path d="M94.992 6.749h-6.84a.95.95 0 0 0-.938.802l-2.766 17.537a.569.569 0 0 0 .562.658h3.51a.665.665 0 0 0 .656-.562l.785-4.971a.95.95 0 0 1 .938-.803h2.164c4.506 0 7.105-2.18 7.785-6.5.307-1.89.012-3.375-.873-4.415-.971-1.142-2.694-1.746-4.983-1.746zm.789 6.405c-.373 2.454-2.248 2.454-4.062 2.454h-1.031l.725-4.583a.568.568 0 0 1 .562-.481h.473c1.234 0 2.4 0 3.002.704.359.42.468 1.044.331 1.906zM115.434 13.075h-3.273a.567.567 0 0 0-.562.481l-.145.916-.23-.332c-.709-1.029-2.289-1.373-3.867-1.373-3.619 0-6.709 2.741-7.311 6.586-.312 1.918.131 3.752 1.219 5.031 1 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .564.66h2.949a.95.95 0 0 0 .938-.803l1.771-11.209a.571.571 0 0 0-.565-.658zm-4.565 6.374c-.314 1.871-1.801 3.127-3.695 3.127-.949 0-1.711-.305-2.199-.883-.484-.574-.666-1.391-.514-2.301.297-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.501.589.699 1.411.554 2.317zM119.295 7.23l-2.807 17.858a.569.569 0 0 0 .562.658h2.822c.469 0 .867-.34.938-.803l2.768-17.536a.57.57 0 0 0-.562-.659h-3.16a.571.571 0 0 0-.561.482z" fill="#179BD7"/>
                <path d="M7.266 29.154l.523-3.322-1.165-.027H1.061L4.927 1.292a.316.316 0 0 1 .314-.268h9.38c3.114 0 5.263.648 6.385 1.927.526.6.861 1.227 1.023 1.917.17.724.173 1.589.007 2.644l-.012.077v.676l.526.298a3.69 3.69 0 0 1 1.065.812c.45.513.741 1.165.864 1.938.127.795.085 1.741-.123 2.812-.24 1.232-.628 2.305-1.152 3.183a6.547 6.547 0 0 1-1.825 2c-.696.494-1.523.869-2.458 1.109-.906.236-1.939.355-3.072.355h-.73c-.522 0-1.029.188-1.427.525a2.21 2.21 0 0 0-.744 1.328l-.055.299-.924 5.855-.042.215c-.011.068-.03.102-.058.125a.155.155 0 0 1-.096.035H7.266z" fill="#253B80"/>
                <path d="M23.048 7.667c-.028.179-.06.362-.096.55-1.237 6.351-5.469 8.545-10.874 8.545H9.326c-.661 0-1.218.48-1.321 1.132L6.596 26.83l-.399 2.533a.704.704 0 0 0 .695.814h4.881c.578 0 1.069-.42 1.16-.99l.048-.248.919-5.832.059-.32c.09-.572.582-.992 1.16-.992h.73c4.729 0 8.431-1.92 9.513-7.476.452-2.321.218-4.259-.978-5.622a4.667 4.667 0 0 0-1.336-1.03z" fill="#179BD7"/>
                <path d="M21.754 7.151a9.757 9.757 0 0 0-1.203-.267 15.284 15.284 0 0 0-2.426-.177h-7.352a1.172 1.172 0 0 0-1.159.992L8.05 17.605l-.045.289a1.336 1.336 0 0 1 1.321-1.132h2.752c5.405 0 9.637-2.195 10.874-8.545.037-.188.068-.371.096-.55a6.594 6.594 0 0 0-1.017-.429 9.045 9.045 0 0 0-.277-.087z" fill="#222D65"/>
                <path d="M9.614 7.699a1.169 1.169 0 0 1 1.159-.991h7.352c.871 0 1.684.057 2.426.177a9.757 9.757 0 0 1 1.481.353c.365.121.704.264 1.017.429.368-2.347-.003-3.945-1.272-5.392C20.378.682 17.853 0 14.622 0h-9.38c-.66 0-1.223.48-1.325 1.133L.01 25.898a.806.806 0 0 0 .795.932h5.791l1.454-9.225 1.564-9.906z" fill="#253B80"/>
              </svg>
            </span>
          </button>
        </div>
      </div>

      <div class="payment-section">
        <h4>&#127974; Transferencias Bancarias (RD)</h4>
        <div class="transfer-buttons">
          <button class="payment-btn whatsapp-btn" onclick="validateAndContact('https://wa.me/18299441515?text=${whatsappBaseMsg}')">
            <span class="payment-icon">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
            </span>
            <span>Contactar por WhatsApp</span>
          </button>
        </div>
      </div>

      <div class="payment-note">
        <p><strong>Nota importante:</strong></p>
        <p>&#8226; Paga con tarjeta de forma segura usando Stripe o PayPal</p>
        <p>&#8226; No es necesario tener cuenta PayPal para pagar con tarjeta</p>
        <p>&#8226; Para transferencias bancarias en Rep&#250;blica Dominicana, cont&#225;ctanos</p>
        <p>&#8226; Recibir&#225;s el producto al correo registrado (revisar spam)</p>
        <p>&#8226; Producto digital - todas las ventas son finales</p>
        <p>&#8226; Compatible &#250;nicamente con Google Sheets</p>
      </div>
    `;

    // Wire up terms checkbox
    const termsCheckbox = document.getElementById('termsCheckbox');
    const termsContainer = document.getElementById('termsCheckboxContainer');
    const errorMessage = document.getElementById('termsErrorMessage');
    if (termsCheckbox) {
      termsCheckbox.checked = false;
      termsCheckbox.addEventListener('change', function() {
        if (this.checked) {
          termsContainer.classList.remove('error');
          errorMessage.classList.remove('show');
        }
      });
    }
  }
}

function launchGiftExplosion() {
  const emojis = ['üéÅ', 'üéä', 'üéâ', 'ü•≥', 'üéÄ', '‚ú®', 'üéà', 'üéÅ', 'üéä', 'üéâ', '‚ú®', 'üéà'];
  const container = document.createElement('div');
  container.className = 'gift-explosion-container';
  document.body.appendChild(container);

  emojis.forEach((emoji) => {
    const el = document.createElement('span');
    el.className = 'explosion-emoji';
    el.textContent = emoji;
    el.style.left = Math.random() * 100 + 'vw';
    el.style.animationDelay = (Math.random() * 0.3) + 's';
    el.style.animationDuration = (1.5 + Math.random() * 1.5) + 's';
    el.style.fontSize = (20 + Math.random() * 25) + 'px';
    container.appendChild(el);
  });

  setTimeout(() => container.remove(), 3500);
}

function updateProductCardPrices() {
  const productCards = document.querySelectorAll('.product-card');

  productCards.forEach(card => {
    const existingBadge = card.querySelector('.gift-badge');

    if (giftModeActive) {
      if (!existingBadge) {
        const badge = document.createElement('span');
        badge.className = 'gift-badge';
        badge.innerHTML = '&#127873; REGALO';
        card.appendChild(badge);
      }
    } else {
      if (existingBadge) existingBadge.remove();
    }
  });
}

// Scroll Animation Observer - Optimizado para m√≥viles
const isMobile = window.innerWidth <= 768;
const observerOptions = {
  threshold: isMobile ? 0.01 : 0.05, // Trigger mucho antes en m√≥viles
  rootMargin: isMobile ? '100px 0px -50px 0px' : '50px 0px -20px 0px' // M√°s margen en m√≥viles
};

const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    // No animar si ya fue procesado por el quiz o ya tiene la clase animate
    if (entry.isIntersecting &&
      !entry.target.classList.contains('animate') &&
      !entry.target.hasAttribute('data-quiz-processed') &&
      !entry.target.classList.contains('no-scroll-animate')) {
      entry.target.classList.add('animate');
      observer.unobserve(entry.target);
    }
  });
}, observerOptions);

// Initialize scroll animations when DOM is loaded
document.addEventListener('DOMContentLoaded', function () {
  const productCards = document.querySelectorAll('.product-card');
  productCards.forEach(card => {
    observer.observe(card);
  });

  // Abrir producto autom√°ticamente si hay par√°metro de URL o hash
  const urlParams = new URLSearchParams(window.location.search);
  const productParam = urlParams.get('product'); // Para Manychat: ?product=productId
  const hash = window.location.hash.substring(1); // Para hash: #productId

  const productId = productParam || hash;

  if (productId && productData[productId]) {
    // Esperar un momento para que la p√°gina cargue completamente
    setTimeout(() => {
      showProductDetails(productId);
    }, 500);
  }
});

// Product Details Modal
function showProductDetails(productId, scrollToPayment = false) {
  const product = productData[productId];
  const modal = document.getElementById('productModal');
  const modalContent = document.getElementById('modalContent');

  // Determine current PayPal link and image based on neutral state and gift mode
  let currentPaypalLink = product.paypalLink;
  let currentStripeLink = product.stripeLink;
  let currentImage = product.image;

  const isProNeutral = productId === 'plantillaPro' && currentNeutralStates.pro;
  const isBasicNeutral = productId === 'plantillaBasica' && currentNeutralStates.basic;

  if (isProNeutral) {
    currentPaypalLink = product.neutralPaypalLink || currentPaypalLink;
    currentStripeLink = product.neutralStripeLink || currentStripeLink;
    currentImage = 'imagenes/plantillaProNeutral.png';
  }
  if (isBasicNeutral) {
    currentPaypalLink = product.neutralPaypalLink || currentPaypalLink;
    currentStripeLink = product.neutralStripeLink || currentStripeLink;
    currentImage = 'imagenes/plantillaNeutra.png';
  }



  // Build gift form HTML if gift mode is active
  const giftFormHTML = giftModeActive ? `
    <div class="gift-form-section">
      <h3 class="gift-form-title">&#127873; Datos del Regalo</h3>
      <p class="gift-form-subtitle">Enviaremos el producto directamente a esta persona con un mensaje especial de tu parte</p>
      <div class="gift-form-field">
        <label for="giftBuyerName">Tu nombre</label>
        <input type="text" id="giftBuyerName" placeholder="Ej: Fulanito De Tal">
      </div>
      <div class="gift-form-field">
        <label for="giftBuyerEmail">Tu correo electr&#243;nico</label>
        <input type="email" id="giftBuyerEmail" placeholder="Ej: fulanito@email.com">
        <small class="gift-email-hint">&#9888;&#65039; Usa el mismo correo con el que vas a realizar el pago</small>
      </div>
      <div class="gift-form-field">
        <label for="giftRecipientName">Nombre de quien recibe el regalo</label>
        <input type="text" id="giftRecipientName" placeholder="Ej: Fulanito De Tal">
      </div>
      <div class="gift-form-field">
        <label for="giftRecipientContact">Correo electr&#243;nico de quien recibe</label>
        <input type="email" id="giftRecipientContact" placeholder="Ej: fulanito@email.com">
      </div>
      <div class="gift-form-field">
        <label for="giftMessage">Dedicatoria (opcional)</label>
        <textarea id="giftMessage" placeholder="Ej: Felicidades! Te quiero mucho &#10084;&#65039;" rows="3" maxlength="200"></textarea>
        <small class="gift-char-counter"><span id="giftMessageCount">0</span>/200</small>
      </div>
    </div>
  ` : '';

  // Build WhatsApp message
  const whatsappBaseMsg = `Hola!%20Me%20interesa%20la%20${encodeURIComponent(product.title)}%20-%20Transferencia%20bancaria`;

  // Build payment section based on gift mode
  let paymentHTML = '';
  if (giftModeActive) {
    // Gift mode: all payment methods with gift data submission
    paymentHTML = `
    <div class="payment-options">
      <h3 class="payment-title">&#127873; Comprar como Regalo</h3>

      <button class="modal-gift-deactivate" onclick="toggleGiftInModal('${productId}')">
        &#10005; Desactivar Modo Regalo
      </button>

      <div class="terms-checkbox-container" id="termsCheckboxContainer">
        <label class="terms-checkbox-label">
          <input type="checkbox" id="termsCheckbox" class="terms-checkbox">
          <span>He le&#237;do y acepto los <button type="button" class="terms-link" onclick="openTermsModal()">T&#233;rminos y Condiciones</button></span>
        </label>
        <div class="terms-error-message" id="termsErrorMessage">
          ‚ö†Ô∏è Debes aceptar los T&#233;rminos y Condiciones para continuar
        </div>
      </div>

      <div class="payment-section">
        <h4>&#128179; Pago con tarjeta de cr&#233;dito/d&#233;bito</h4>
        <div class="payment-buttons">
          <button class="payment-btn paypal-btn" onclick="submitGiftAndPay('${currentPaypalLink}', '${productId}', 'paypal')">
            <span class="payment-icon">
              <svg width="80" height="32" viewBox="0 0 124 33" fill="none">
                <path d="M46.211 6.749h-6.839a.95.95 0 0 0-.939.802l-2.766 17.537a.57.57 0 0 0 .564.658h3.265a.95.95 0 0 0 .939-.803l.746-4.73a.95.95 0 0 1 .938-.803h2.165c4.505 0 7.105-2.18 7.784-6.5.306-1.89.013-3.375-.872-4.415-.972-1.142-2.696-1.746-4.985-1.746zM47 13.154c-.374 2.454-2.249 2.454-4.062 2.454h-1.032l.724-4.583a.57.57 0 0 1 .563-.481h.473c1.235 0 2.4 0 3.002.704.359.42.469 1.044.332 1.906zM66.654 13.075h-3.275a.57.57 0 0 0-.563.481l-.145.916-.229-.332c-.709-1.029-2.29-1.373-3.868-1.373-3.619 0-6.71 2.741-7.312 6.586-.313 1.918.132 3.752 1.22 5.031.998 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .562.66h2.95a.95.95 0 0 0 .939-.803l1.77-11.209a.568.568 0 0 0-.561-.658zm-4.565 6.374c-.316 1.871-1.801 3.127-3.695 3.127-.951 0-1.711-.305-2.199-.883-.484-.574-.668-1.391-.514-2.301.295-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.499.589.697 1.411.554 2.317zM84.096 13.075h-3.291a.954.954 0 0 0-.787.417l-4.539 6.686-1.924-6.425a.953.953 0 0 0-.912-.678h-3.234a.57.57 0 0 0-.541.754l3.625 10.638-3.408 4.811a.57.57 0 0 0 .465.9h3.287a.949.949 0 0 0 .781-.408l10.946-15.8a.57.57 0 0 0-.468-.895z" fill="#253B80"/>
                <path d="M94.992 6.749h-6.84a.95.95 0 0 0-.938.802l-2.766 17.537a.569.569 0 0 0 .562.658h3.51a.665.665 0 0 0 .656-.562l.785-4.971a.95.95 0 0 1 .938-.803h2.164c4.506 0 7.105-2.18 7.785-6.5.307-1.89.012-3.375-.873-4.415-.971-1.142-2.694-1.746-4.983-1.746zm.789 6.405c-.373 2.454-2.248 2.454-4.062 2.454h-1.031l.725-4.583a.568.568 0 0 1 .562-.481h.473c1.234 0 2.4 0 3.002.704.359.42.468 1.044.331 1.906zM115.434 13.075h-3.273a.567.567 0 0 0-.562.481l-.145.916-.23-.332c-.709-1.029-2.289-1.373-3.867-1.373-3.619 0-6.709 2.741-7.311 6.586-.312 1.918.131 3.752 1.219 5.031 1 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .564.66h2.949a.95.95 0 0 0 .938-.803l1.771-11.209a.571.571 0 0 0-.565-.658zm-4.565 6.374c-.314 1.871-1.801 3.127-3.695 3.127-.949 0-1.711-.305-2.199-.883-.484-.574-.666-1.391-.514-2.301.297-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.501.589.699 1.411.554 2.317zM119.295 7.23l-2.807 17.858a.569.569 0 0 0 .562.658h2.822c.469 0 .867-.34.938-.803l2.768-17.536a.57.57 0 0 0-.562-.659h-3.16a.571.571 0 0 0-.561.482z" fill="#179BD7"/>
                <path d="M7.266 29.154l.523-3.322-1.165-.027H1.061L4.927 1.292a.316.316 0 0 1 .314-.268h9.38c3.114 0 5.263.648 6.385 1.927.526.6.861 1.227 1.023 1.917.17.724.173 1.589.007 2.644l-.012.077v.676l.526.298a3.69 3.69 0 0 1 1.065.812c.45.513.741 1.165.864 1.938.127.795.085 1.741-.123 2.812-.24 1.232-.628 2.305-1.152 3.183a6.547 6.547 0 0 1-1.825 2c-.696.494-1.523.869-2.458 1.109-.906.236-1.939.355-3.072.355h-.73c-.522 0-1.029.188-1.427.525a2.21 2.21 0 0 0-.744 1.328l-.055.299-.924 5.855-.042.215c-.011.068-.03.102-.058.125a.155.155 0 0 1-.096.035H7.266z" fill="#253B80"/>
                <path d="M23.048 7.667c-.028.179-.06.362-.096.55-1.237 6.351-5.469 8.545-10.874 8.545H9.326c-.661 0-1.218.48-1.321 1.132L6.596 26.83l-.399 2.533a.704.704 0 0 0 .695.814h4.881c.578 0 1.069-.42 1.16-.99l.048-.248.919-5.832.059-.32c.09-.572.582-.992 1.16-.992h.73c4.729 0 8.431-1.92 9.513-7.476.452-2.321.218-4.259-.978-5.622a4.667 4.667 0 0 0-1.336-1.03z" fill="#179BD7"/>
                <path d="M21.754 7.151a9.757 9.757 0 0 0-1.203-.267 15.284 15.284 0 0 0-2.426-.177h-7.352a1.172 1.172 0 0 0-1.159.992L8.05 17.605l-.045.289a1.336 1.336 0 0 1 1.321-1.132h2.752c5.405 0 9.637-2.195 10.874-8.545.037-.188.068-.371.096-.55a6.594 6.594 0 0 0-1.017-.429 9.045 9.045 0 0 0-.277-.087z" fill="#222D65"/>
                <path d="M9.614 7.699a1.169 1.169 0 0 1 1.159-.991h7.352c.871 0 1.684.057 2.426.177a9.757 9.757 0 0 1 1.481.353c.365.121.704.264 1.017.429.368-2.347-.003-3.945-1.272-5.392C20.378.682 17.853 0 14.622 0h-9.38c-.66 0-1.223.48-1.325 1.133L.01 25.898a.806.806 0 0 0 .795.932h5.791l1.454-9.225 1.564-9.906z" fill="#253B80"/>
              </svg>
            </span>
          </button>
        </div>
      </div>

      <div class="payment-section">
        <h4>&#127974; Transferencias Bancarias (RD)</h4>
        <div class="transfer-buttons">
          <button class="payment-btn whatsapp-btn gift-whatsapp-btn" onclick="sendGiftWhatsApp('${productId}')">
            <span class="payment-icon">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
            </span>
            <span>Enviar regalo por WhatsApp</span>
          </button>
        </div>
      </div>

      <div class="payment-note">
        <p><strong>&#127873; Nota sobre el Modo Regalo:</strong></p>
        <p>&#8226; El producto se env&#237;a directo al correo de la persona que indiques</p>
        <p>&#8226; Incluir&#225; tu dedicatoria si la escribes</p>
        <p>&#8226; Producto digital - todas las ventas son finales</p>
        <p>&#8226; Compatible &#250;nicamente con Google Sheets</p>
      </div>
    </div>`;
  } else {
    // Normal mode: all payment options
    paymentHTML = `
    <div class="payment-options">
      <h3 class="payment-title">Opciones de Pago</h3>

      <div class="modal-gift-toggle" onclick="toggleGiftInModal('${productId}')">
        <span class="modal-gift-toggle-icon">&#127873;</span>
        <p class="modal-gift-toggle-text"><strong>Regala este producto</strong></p>
        <span class="modal-gift-toggle-btn">Regalar</span>
      </div>

      <div class="terms-checkbox-container" id="termsCheckboxContainer">
        <label class="terms-checkbox-label">
          <input type="checkbox" id="termsCheckbox" class="terms-checkbox">
          <span>He le&#237;do y acepto los <button type="button" class="terms-link" onclick="openTermsModal()">T&#233;rminos y Condiciones</button></span>
        </label>
        <div class="terms-error-message" id="termsErrorMessage">
          ‚ö†Ô∏è Debes aceptar los T&#233;rminos y Condiciones para continuar
        </div>
      </div>

      <div class="payment-section">
        <h4>&#128179; Pago con tarjeta de cr&#233;dito/d&#233;bito</h4>
        <div class="payment-buttons">
          <button class="payment-btn stripe-btn" onclick="validateAndBuy('${currentStripeLink}')">
            <span class="payment-icon">
              <svg width="80" height="32" viewBox="0 0 60 25" fill="none">
                <path d="M59.64 14.28h-8.06c.19 1.93 1.6 2.55 3.2 2.55 1.64 0 2.96-.37 4.05-.95v3.32a8.33 8.33 0 0 1-4.56 1.1c-4.01 0-6.83-2.5-6.83-7.48 0-4.19 2.39-7.52 6.3-7.52 3.92 0 5.96 3.28 5.96 7.5 0 .4-.04 1.26-.06 1.48zm-5.92-5.62c-1.03 0-2.17.73-2.17 2.58h4.25c0-1.85-1.07-2.58-2.08-2.58zM40.95 20.3c-1.44 0-2.32-.6-2.9-1.04l-.02 4.63-4.12.87V5.57h3.76l.08 1.02a4.7 4.7 0 0 1 3.23-1.29c2.9 0 5.62 2.6 5.62 7.4 0 5.23-2.7 7.6-5.65 7.6zM40 8.95c-.95 0-1.54.34-1.97.81l.02 6.12c.4.44.98.78 1.95.78 1.52 0 2.54-1.65 2.54-3.87 0-2.15-1.04-3.84-2.54-3.84zM28.24 5.57h4.13v14.44h-4.13V5.57zm0-4.7L32.37 0v3.36l-4.13.88V.88zm-4.32 9.35v9.79H19.8V5.57h3.7l.12 1.22c1-1.77 3.07-1.41 3.62-1.22v3.79c-.52-.17-2.29-.43-3.32.86zm-8.55 4.72c0 2.43 2.6 1.68 3.12 1.46v3.36c-.55.3-1.54.54-2.89.54a4.15 4.15 0 0 1-4.27-4.24l.01-13.17 4.02-.86v3.54h3.14V9.1h-3.13v5.85zm-4.91.7c0 2.97-2.31 4.66-5.73 4.66a11.2 11.2 0 0 1-4.46-.93v-3.93c1.38.75 3.1 1.31 4.46 1.31.92 0 1.53-.24 1.53-1C6.26 13.77 0 14.51 0 9.95 0 7.04 2.28 5.3 5.62 5.3c1.36 0 2.72.2 4.09.75v3.88a9.23 9.23 0 0 0-4.1-1.06c-.86 0-1.44.25-1.44.93 0 1.85 6.29.97 6.29 5.88z" fill="white"/>
              </svg>
            </span>
          </button>
          <button class="payment-btn paypal-btn" onclick="validateAndBuy('${currentPaypalLink}')">
            <span class="payment-icon">
              <svg width="80" height="32" viewBox="0 0 124 33" fill="none">
                <path d="M46.211 6.749h-6.839a.95.95 0 0 0-.939.802l-2.766 17.537a.57.57 0 0 0 .564.658h3.265a.95.95 0 0 0 .939-.803l.746-4.73a.95.95 0 0 1 .938-.803h2.165c4.505 0 7.105-2.18 7.784-6.5.306-1.89.013-3.375-.872-4.415-.972-1.142-2.696-1.746-4.985-1.746zM47 13.154c-.374 2.454-2.249 2.454-4.062 2.454h-1.032l.724-4.583a.57.57 0 0 1 .563-.481h.473c1.235 0 2.4 0 3.002.704.359.42.469 1.044.332 1.906zM66.654 13.075h-3.275a.57.57 0 0 0-.563.481l-.145.916-.229-.332c-.709-1.029-2.29-1.373-3.868-1.373-3.619 0-6.71 2.741-7.312 6.586-.313 1.918.132 3.752 1.22 5.031.998 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .562.66h2.95a.95.95 0 0 0 .939-.803l1.77-11.209a.568.568 0 0 0-.561-.658zm-4.565 6.374c-.316 1.871-1.801 3.127-3.695 3.127-.951 0-1.711-.305-2.199-.883-.484-.574-.668-1.391-.514-2.301.295-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.499.589.697 1.411.554 2.317zM84.096 13.075h-3.291a.954.954 0 0 0-.787.417l-4.539 6.686-1.924-6.425a.953.953 0 0 0-.912-.678h-3.234a.57.57 0 0 0-.541.754l3.625 10.638-3.408 4.811a.57.57 0 0 0 .465.9h3.287a.949.949 0 0 0 .781-.408l10.946-15.8a.57.57 0 0 0-.468-.895z" fill="#253B80"/>
                <path d="M94.992 6.749h-6.84a.95.95 0 0 0-.938.802l-2.766 17.537a.569.569 0 0 0 .562.658h3.51a.665.665 0 0 0 .656-.562l.785-4.971a.95.95 0 0 1 .938-.803h2.164c4.506 0 7.105-2.18 7.785-6.5.307-1.89.012-3.375-.873-4.415-.971-1.142-2.694-1.746-4.983-1.746zm.789 6.405c-.373 2.454-2.248 2.454-4.062 2.454h-1.031l.725-4.583a.568.568 0 0 1 .562-.481h.473c1.234 0 2.4 0 3.002.704.359.42.468 1.044.331 1.906zM115.434 13.075h-3.273a.567.567 0 0 0-.562.481l-.145.916-.23-.332c-.709-1.029-2.289-1.373-3.867-1.373-3.619 0-6.709 2.741-7.311 6.586-.312 1.918.131 3.752 1.219 5.031 1 1.176 2.426 1.666 4.125 1.666 2.916 0 4.533-1.875 4.533-1.875l-.146.91a.57.57 0 0 0 .564.66h2.949a.95.95 0 0 0 .938-.803l1.771-11.209a.571.571 0 0 0-.565-.658zm-4.565 6.374c-.314 1.871-1.801 3.127-3.695 3.127-.949 0-1.711-.305-2.199-.883-.484-.574-.666-1.391-.514-2.301.297-1.855 1.805-3.152 3.67-3.152.93 0 1.686.309 2.184.892.501.589.699 1.411.554 2.317zM119.295 7.23l-2.807 17.858a.569.569 0 0 0 .562.658h2.822c.469 0 .867-.34.938-.803l2.768-17.536a.57.57 0 0 0-.562-.659h-3.16a.571.571 0 0 0-.561.482z" fill="#179BD7"/>
                <path d="M7.266 29.154l.523-3.322-1.165-.027H1.061L4.927 1.292a.316.316 0 0 1 .314-.268h9.38c3.114 0 5.263.648 6.385 1.927.526.6.861 1.227 1.023 1.917.17.724.173 1.589.007 2.644l-.012.077v.676l.526.298a3.69 3.69 0 0 1 1.065.812c.45.513.741 1.165.864 1.938.127.795.085 1.741-.123 2.812-.24 1.232-.628 2.305-1.152 3.183a6.547 6.547 0 0 1-1.825 2c-.696.494-1.523.869-2.458 1.109-.906.236-1.939.355-3.072.355h-.73c-.522 0-1.029.188-1.427.525a2.21 2.21 0 0 0-.744 1.328l-.055.299-.924 5.855-.042.215c-.011.068-.03.102-.058.125a.155.155 0 0 1-.096.035H7.266z" fill="#253B80"/>
                <path d="M23.048 7.667c-.028.179-.06.362-.096.55-1.237 6.351-5.469 8.545-10.874 8.545H9.326c-.661 0-1.218.48-1.321 1.132L6.596 26.83l-.399 2.533a.704.704 0 0 0 .695.814h4.881c.578 0 1.069-.42 1.16-.99l.048-.248.919-5.832.059-.32c.09-.572.582-.992 1.16-.992h.73c4.729 0 8.431-1.92 9.513-7.476.452-2.321.218-4.259-.978-5.622a4.667 4.667 0 0 0-1.336-1.03z" fill="#179BD7"/>
                <path d="M21.754 7.151a9.757 9.757 0 0 0-1.203-.267 15.284 15.284 0 0 0-2.426-.177h-7.352a1.172 1.172 0 0 0-1.159.992L8.05 17.605l-.045.289a1.336 1.336 0 0 1 1.321-1.132h2.752c5.405 0 9.637-2.195 10.874-8.545.037-.188.068-.371.096-.55a6.594 6.594 0 0 0-1.017-.429 9.045 9.045 0 0 0-.277-.087z" fill="#222D65"/>
                <path d="M9.614 7.699a1.169 1.169 0 0 1 1.159-.991h7.352c.871 0 1.684.057 2.426.177a9.757 9.757 0 0 1 1.481.353c.365.121.704.264 1.017.429.368-2.347-.003-3.945-1.272-5.392C20.378.682 17.853 0 14.622 0h-9.38c-.66 0-1.223.48-1.325 1.133L.01 25.898a.806.806 0 0 0 .795.932h5.791l1.454-9.225 1.564-9.906z" fill="#253B80"/>
              </svg>
            </span>
          </button>
        </div>
      </div>

      <div class="payment-section">
        <h4>&#127974; Transferencias Bancarias (RD)</h4>
        <div class="transfer-buttons">
          <button class="payment-btn whatsapp-btn" onclick="validateAndContact('https://wa.me/18299441515?text=${whatsappBaseMsg}')">
            <span class="payment-icon">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
            </span>
            <span>Contactar por WhatsApp</span>
          </button>
        </div>
      </div>

      <div class="payment-note">
        <p><strong>Nota importante:</strong></p>
        <p>&#8226; Paga con tarjeta de forma segura usando Stripe o PayPal</p>
        <p>&#8226; No es necesario tener cuenta PayPal para pagar con tarjeta</p>
        <p>&#8226; Para transferencias bancarias en Rep&#250;blica Dominicana, cont&#225;ctanos</p>
        <p>&#8226; Recibir&#225;s el producto al correo registrado (revisar spam)</p>
        <p>&#8226; Producto digital - todas las ventas son finales</p>
        <p>&#8226; Compatible &#250;nicamente con Google Sheets</p>
      </div>
    </div>`;
  }

  modalContent.innerHTML = `
  ${currentImage ? `<img src="${currentImage}" alt="${product.title}" class="modal-product-image">` : ''}
  ${product.content}
  ${giftFormHTML}
  ${paymentHTML}
`;

  modal.classList.remove('closing');
  modal.style.display = 'block';
  document.body.style.overflow = 'hidden';

  // Actualizar URL con query parameter del producto para compartir (funciona mejor en Manychat)
  window.history.pushState(null, null, '?product=' + productId);

  // Reiniciar el scroll al principio cada vez que se abre el modal
  modal.scrollTop = 0;

  // Insertar bot√≥n "Comprar ahora" despu√©s del t√≠tulo
  const productTitle = modalContent.querySelector('h2');
  if (productTitle) {
    const buyButton = document.createElement('div');
    buyButton.style.textAlign = 'center';
    buyButton.style.margin = '1.5rem 0';
    buyButton.innerHTML = `
      <button class="btn btn-primary quick-buy-btn" onclick="document.querySelector(giftModeActive ? '.gift-form-section' : '.payment-options').scrollIntoView({ behavior: 'smooth', block: 'start' })">
        Comprar ahora
      </button>
    `;
    productTitle.parentNode.insertBefore(buyButton, productTitle.nextSibling);
  }

  // Desmarcar el checkbox de t√©rminos para el nuevo producto y agregar event listener
  setTimeout(() => {
    const termsCheckbox = document.getElementById('termsCheckbox');
    const termsContainer = document.getElementById('termsCheckboxContainer');
    const errorMessage = document.getElementById('termsErrorMessage');

    if (termsCheckbox) {
      termsCheckbox.checked = false;

      // Agregar event listener para remover el error cuando se marque el checkbox
      termsCheckbox.addEventListener('change', function () {
        if (this.checked) {
          termsContainer.classList.remove('error');
          errorMessage.classList.remove('show');
        }
      });
    }

    // Add listeners to gift form fields to clear errors on input
    const giftBuyer = document.getElementById('giftBuyerName');
    const giftBuyerMail = document.getElementById('giftBuyerEmail');
    const giftName = document.getElementById('giftRecipientName');
    const giftContact = document.getElementById('giftRecipientContact');
    const giftFields = [giftBuyer, giftBuyerMail, giftName, giftContact];
    giftFields.forEach(field => {
      if (field) {
        field.addEventListener('input', function () {
          this.classList.remove('gift-input-error');
          const giftError = document.getElementById('giftFormError');
          if (giftError && giftBuyer && giftBuyer.value.trim() && giftBuyerMail && giftBuyerMail.value.trim() && giftName && giftName.value.trim() && giftContact && giftContact.value.trim()) {
            giftError.style.display = 'none';
          }
        });
      }
    });

    // Contador de caracteres de la dedicatoria
    const giftMsg = document.getElementById('giftMessage');
    const giftCount = document.getElementById('giftMessageCount');
    if (giftMsg && giftCount) {
      giftMsg.addEventListener('input', function() {
        giftCount.textContent = this.value.length;
      });
    }
  }, 100);

  // Scroll autom√°tico solo si viene del bot√≥n "Comprar ahora"
  if (scrollToPayment) {
    setTimeout(() => {
      const scrollTarget = giftModeActive
        ? document.querySelector('.gift-form-section')
        : document.querySelector('.payment-options');
      if (scrollTarget) {
        scrollTarget.scrollIntoView({
          behavior: 'smooth',
          block: 'start',
          inline: 'nearest'
        });
      }
    }, 400);
  }
}

function closeModal() {
  const modal = document.getElementById('productModal');

  // Agregar clase de animaci√≥n de cierre
  modal.classList.add('closing');

  // Esperar a que termine la animaci√≥n antes de ocultar
  setTimeout(() => {
    modal.style.display = 'none';
    modal.classList.remove('closing');
    document.body.style.overflow = 'auto';

    // Limpiar hash de la URL
    window.history.pushState(null, null, window.location.pathname);

    // Reiniciar el scroll del modal al principio para la pr√≥xima apertura
    modal.scrollTop = 0;
  }, 300); // Duraci√≥n de la animaci√≥n
}

// Buy Now
function buyNow(paypalLink) {
  window.open(paypalLink, '_blank');
}

// Validate Terms and Buy
function validateAndBuy(link) {
  const termsCheckbox = document.getElementById('termsCheckbox');
  const termsContainer = document.getElementById('termsCheckboxContainer');
  const errorMessage = document.getElementById('termsErrorMessage');

  if (!termsCheckbox || !termsCheckbox.checked) {
    termsContainer.classList.add('error');
    errorMessage.classList.add('show');
    termsContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  buyNow(link);
}

// Generate unique gift order ID
function generateGiftOrderId() {
  const timestamp = Date.now();
  const random = Math.random().toString(36).substring(2, 6).toUpperCase();
  return `REGALO_${timestamp}_${random}`;
}

// Validate gift form - returns data object or null if invalid
function validateGiftForm() {
  const buyerNameEl = document.getElementById('giftBuyerName');
  const buyerEmailEl = document.getElementById('giftBuyerEmail');
  const recipientName = document.getElementById('giftRecipientName');
  const recipientContact = document.getElementById('giftRecipientContact');
  const giftMessageEl = document.getElementById('giftMessage');
  const buyerName = buyerNameEl ? buyerNameEl.value.trim() : '';
  const buyerEmail = buyerEmailEl ? buyerEmailEl.value.trim() : '';
  const name = recipientName ? recipientName.value.trim() : '';
  const contact = recipientContact ? recipientContact.value.trim() : '';
  const dedicatoria = giftMessageEl ? giftMessageEl.value.trim() : '';

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const missingFields = !buyerName || !buyerEmail || !name || !contact;
  const invalidEmails = !emailRegex.test(buyerEmail) || !emailRegex.test(contact);
  const hasErrors = missingFields || invalidEmails;

  if (hasErrors) {
    const formSection = document.querySelector('.gift-form-section');
    if (buyerNameEl && !buyerName) buyerNameEl.classList.add('gift-input-error');
    if (buyerEmailEl && (!buyerEmail || !emailRegex.test(buyerEmail))) buyerEmailEl.classList.add('gift-input-error');
    if (recipientName && !name) recipientName.classList.add('gift-input-error');
    if (recipientContact && (!contact || !emailRegex.test(contact))) recipientContact.classList.add('gift-input-error');

    let giftError = document.getElementById('giftFormError');
    const errorMsg = missingFields
      ? 'Completa los datos del regalo para continuar'
      : 'Ingresa correos electr\u00f3nicos v\u00e1lidos';
    if (!giftError) {
      giftError = document.createElement('p');
      giftError.id = 'giftFormError';
      giftError.className = 'gift-form-error';
      formSection.appendChild(giftError);
    }
    giftError.textContent = errorMsg;
    giftError.style.display = 'block';
    formSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return null;
  }

  return { buyerName, buyerEmail, name, contact, dedicatoria };
}

// Convierte emojis a entidades HTML para correos
function emojiToHtmlEntities(str) {
  if (!str) return '';
  return Array.from(str).map(function(char) {
    var cp = char.codePointAt(0);
    return cp > 127 ? '&#' + cp + ';' : char;
  }).join('');
}

// Submit gift data to Apps Script and redirect to payment
async function submitGiftAndPay(paymentLink, productId, paymentType) {
  const termsCheckbox = document.getElementById('termsCheckbox');
  const termsContainer = document.getElementById('termsCheckboxContainer');
  const errorMessage = document.getElementById('termsErrorMessage');

  // Validate gift form
  const giftData = validateGiftForm();
  if (!giftData) return;

  // Validate terms
  if (!termsCheckbox || !termsCheckbox.checked) {
    termsContainer.classList.add('error');
    errorMessage.classList.add('show');
    termsContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  const product = productData[productId];
  const orderId = generateGiftOrderId();

  // Show loading state
  const paymentButtons = document.querySelectorAll('.payment-btn');
  paymentButtons.forEach(btn => btn.classList.add('gift-loading'));

  // Send gift data to Google Apps Script (no-cors to avoid CORS issues)
  var giftPayload = JSON.stringify({
    orderId: orderId,
    buyerName: giftData.buyerName,
    buyerEmail: giftData.buyerEmail,
    recipientName: giftData.name,
    recipientEmail: giftData.contact,
    dedication: giftData.dedicatoria,
    product: product.title,
    productId: (productId === 'plantillaPro' && currentNeutralStates.pro) ? 'plantillaProNeutra'
             : (productId === 'plantillaBasica' && currentNeutralStates.basic) ? 'plantillaBasicaNeutra'
             : productId,
    timestamp: new Date().toISOString(),
    paymentMethod: paymentType
  });

  try {
    await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      body: giftPayload
    });
  } catch (error) {
    console.error('Error enviando datos del regalo:', error);
  }

  // Always redirect to payment (even if Apps Script call had issues)
  let finalLink = paymentLink;
  if (paymentType === 'stripe') {
    finalLink += (paymentLink.includes('?') ? '&' : '?') + 'client_reference_id=' + orderId;
  }

  paymentButtons.forEach(btn => btn.classList.remove('gift-loading'));
  window.location.href = finalLink;
}

// Send Gift WhatsApp (Manychat format)
function sendGiftWhatsApp(productId) {
  const termsCheckbox = document.getElementById('termsCheckbox');
  const termsContainer = document.getElementById('termsCheckboxContainer');
  const errorMessage = document.getElementById('termsErrorMessage');

  // Validate gift form
  const giftData = validateGiftForm();
  if (!giftData) return;

  // Validate terms
  if (!termsCheckbox || !termsCheckbox.checked) {
    termsContainer.classList.add('error');
    errorMessage.classList.add('show');
    termsContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  const product = productData[productId];

  // Build message: keyword first for Manychat, then product, then gift data
  const lines = ['Regala Un Planifesto'];
  const giftTitle = productId === 'plantillaBasica' ? 'Plantilla Financiera Basica' : product.title;
  lines.push(`Regalo: ${giftTitle}`);
  lines.push(`De: ${giftData.buyerName} (${giftData.buyerEmail})`);
  lines.push(`Para: ${giftData.name}`);
  lines.push(`Contacto destinatario: ${giftData.contact}`);
  if (giftData.dedicatoria) {
    lines.push(`Dedicatoria: ${giftData.dedicatoria}`);
  }

  const message = encodeURIComponent(lines.join('\n'));
  window.open(`https://wa.me/18299441515?text=${message}`, '_blank');
}

// Validate Terms and Contact (WhatsApp)
function validateAndContact(link) {
  const termsCheckbox = document.getElementById('termsCheckbox');
  const termsContainer = document.getElementById('termsCheckboxContainer');
  const errorMessage = document.getElementById('termsErrorMessage');

  if (!termsCheckbox || !termsCheckbox.checked) {
    termsContainer.classList.add('error');
    errorMessage.classList.add('show');
    termsContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  window.open(link, '_blank');
}

// Open Terms Modal
function openTermsModal() {
  const termsModal = document.getElementById('termsModal');
  termsModal.classList.remove('closing');
  termsModal.style.display = 'block';
  termsModal.scrollTop = 0;
}

// Close Terms Modal
function closeTermsModal() {
  const termsModal = document.getElementById('termsModal');

  // Agregar clase de animaci√≥n de cierre
  termsModal.classList.add('closing');

  // Esperar a que termine la animaci√≥n antes de ocultar
  setTimeout(() => {
    termsModal.style.display = 'none';
    termsModal.classList.remove('closing');
  }, 300); // Duraci√≥n de la animaci√≥n
}

// Toggle Neutral Version
function toggleNeutral(type) {
  const isNeutral = currentNeutralStates[type];

  if (type === 'pro') {
    const img = document.getElementById('proProdImg');
    const title = document.getElementById('proProdTitle');

    if (!isNeutral) {
      img.src = 'imagenes/plantillaProNeutral.png';
      title.textContent = 'Plantilla Financiera PRO (3-1) - Neutral';
    } else {
      img.src = 'imagenes/planifestoPro.png';
      title.textContent = 'Plantilla Financiera PRO (3-1)';
    }
    currentNeutralStates.pro = !isNeutral;
  } else if (type === 'basic') {
    const img = document.getElementById('basicProdImg');
    const title = document.getElementById('basicProdTitle');

    if (!isNeutral) {
      img.src = 'imagenes/plantillaNeutra.png';
      title.textContent = 'Plantilla Financiera - Neutral';
    } else {
      img.src = 'imagenes/presupuestoMensual.png';
      title.textContent = 'Plantilla Financiera';
    }
    currentNeutralStates.basic = !isNeutral;
  }
}

// Quiz Functions
function toggleQuizPopup() {
  const popup = document.getElementById('quizPopup');
  popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
}

function startQuizSection() {
  toggleQuizPopup();
}

function quizStep2(type) {
  document.getElementById('quizStep1').style.display = 'none';
  document.getElementById('quizStep2').style.display = 'block';
}

function showQuizResult(type) {
  document.getElementById('quizStep1').style.display = 'none';
  document.getElementById('quizResult').style.display = 'block';

  let recommendation = '';
  let productId = '';

  if (type === 'pareja') {
    recommendation = 'Plantilla Financiera de Parejas üíë';
    productId = 'plantillaParejas';
  }

  document.getElementById('recommendationText').textContent = recommendation;
  document.getElementById('goToProductBtn').onclick = () => goToProduct(productId);
}

function calculateQuizResult() {
  const checkboxes = document.querySelectorAll('#quizStep2 input[type="checkbox"]:checked');
  const selected = Array.from(checkboxes).map(cb => cb.value);

  if (selected.length === 0) {
    alert('Por favor selecciona al menos una opci√≥n');
    return;
  }

  let recommendation = '';
  let productId = '';

  if (selected.includes('presupuesto') && !selected.includes('ahorro') && !selected.includes('deuda') && !selected.includes('inversion')) {
    recommendation = 'Plantilla Financiera B√°sica üßæ';
    productId = 'plantillaBasica';
  } else if (selected.includes('presupuesto') && (selected.includes('ahorro') || selected.includes('deuda')) && !selected.includes('inversion')) {
    recommendation = 'Plantilla Financiera PRO üíº';
    productId = 'plantillaPro';
  } else if (selected.includes('inversion')) {
    // Si solo seleccionan inversi√≥n, recomendar la gu√≠a de inversiones
    if (selected.length === 1) {
      recommendation = 'Gu√≠a de Inversiones 101 ‚Äì VERSI√ìN 2.0 üìö';
      productId = 'bundleFinanzas';
    } else if (selected.includes('presupuesto') || selected.includes('ahorro') || selected.includes('deuda')) {
      // Si seleccionan inversi√≥n + cualquier otra cosa financiera
      recommendation = 'Combo Planifesto üî•';
      productId = 'comboPlanifesto';
    } else {
      recommendation = 'Gu√≠a de Inversiones 101 ‚Äì VERSI√ìN 2.0 üìö';
      productId = 'bundleFinanzas';
    }
  } else {
    recommendation = 'Plantilla Financiera PRO üíº';
    productId = 'plantillaPro';
  }

  document.getElementById('quizStep2').style.display = 'none';
  document.getElementById('quizResult').style.display = 'block';
  document.getElementById('recommendationText').textContent = recommendation;
  document.getElementById('goToProductBtn').onclick = () => goToProduct(productId);
}
function goToProduct(productId) {
  toggleQuizPopup();
  const productCard = document.querySelector(`[data-product="${productId}"]`);
  if (productCard) {
    // Marcar como ya procesado para evitar re-animaciones
    productCard.setAttribute('data-quiz-processed', 'true');

    productCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
    setTimeout(() => {
      // Forzar estado final visible y remover todas las animaciones CSS
      productCard.style.opacity = '1';
      productCard.style.transform = 'translateY(0)';
      productCard.style.animation = 'none';

      // Force reflow
      productCard.offsetHeight;

      // Aplicar solo el pulso
      productCard.style.animation = 'cardPulse 0.8s ease 3';

      // Despu√©s del pulso, mantener estado final y bloquear futuras animaciones
      setTimeout(() => {
        productCard.style.animation = 'none';
        productCard.style.opacity = '1';
        productCard.style.transform = 'translateY(0)';
        // Agregar clase para prevenir futuras animaciones
        productCard.classList.add('no-scroll-animate');
      }, 2400);
    }, 800);
  }
}

function resetQuiz() {
  document.getElementById('quizResult').style.display = 'none';
  document.getElementById('quizStep2').style.display = 'none';
  document.getElementById('quizStep1').style.display = 'block';
  document.querySelectorAll('#quizStep2 input[type="checkbox"]').forEach(cb => cb.checked = false);
}

// Add scroll function
function scrollToProducts() {
  document.getElementById('productos').scrollIntoView({
    behavior: 'smooth',
    block: 'start'
  });
}

// Close modal when clicking outside
window.onclick = function (event) {
  const modal = document.getElementById('productModal');
  const termsModal = document.getElementById('termsModal');

  if (event.target === modal) {
    closeModal();
  }

  if (event.target === termsModal) {
    closeTermsModal();
  }
}

// ===== Curso Popup =====
document.addEventListener('DOMContentLoaded', function () {
  // Limpiar clave anterior si exist√≠a
  sessionStorage.removeItem('cursoPopupDismissed');

  if (!sessionStorage.getItem('cursoPopup_v2_dismissed')) {
    setTimeout(function () {
      var popup = document.getElementById('cursoPopup');
      if (popup) popup.classList.add('active');
    }, 1500);
  }
});

function closeCursoPopup() {
  var popup = document.getElementById('cursoPopup');
  if (!popup) return;
  popup.classList.add('closing');
  setTimeout(function () {
    popup.style.display = 'none';
  }, 300);
  sessionStorage.setItem('cursoPopup_v2_dismissed', '1');
}

function closeCursoPopupOutside(event) {
  if (event.target === document.getElementById('cursoPopup')) {
    closeCursoPopup();
  }
}
